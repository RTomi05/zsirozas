<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zsírozás</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-4.0.0.js" integrity="sha256-9fsHeVnKBvqh3FB2HYu7g2xseAZ5MlN6Kz/qnkASV8U=" crossorigin="anonymous"></script>

    <style>
        img
        {
            height: 20%;
            width: 50%;
        }


    </style>

</head>

<body class="bg-dark">

    <div class="container col-lg-12 bg-success">
        <div class="row">
                <div class="col-lg-6">
                <h1 class="text-light">Csatlakozás játékhoz</h1>
                <div class="col-6 input-group md-3">   
                    <label for="nev" class="text-light py-2 m-1">Név:</label>
                    <input type="text" id="nev" class="my-2">
                </div>
                <div class="col-lg-6 input-group md-3">
                    <label for="kod" class="text-light py-2 m-1">Kód:</label>
                    <input type="text" id="kod" class="my-2">
                </div>
                <div class="col-lg-6 input-group md-3">
                    <label for="jatekosSzam" class="text-light py-2 m-1">Játékos szám:</label>
                    <input type="range" id="jatekosSzam" class="my-2" onmouseup="kiir()" min="1" max="4">
                    <label for="jatekosSzam" class="text-light py-2 m-1" id="jatekosSzamkiir"></label>
                </div>
                <div class="col-lg-6 input-group md-1 mb-4">
                    <button onclick="kuld()">Belépés</button>
                    <button onclick="loginGet()">Frissít</button>
                </div>




            </div>
            <div class="col-lg-6" id="userBlokk">
                <h1 class="text-light">Lobby</h1>
                <div class="col-lg-6" id="userek">

                </div>

            </div>
        </div>
        

    </div>

    <script>

        let nev;
        let upd;
    function kiir()
    {
        
        document.getElementById("jatekosSzamkiir").innerHTML = document.getElementById("jatekosSzam").value
    }

	function kuld()
	{
        const userek = document.getElementById("userek");
		nev=document.getElementById("nev").value;
		const kod=document.getElementById("kod").value;

		if(nev=="" || kod=="") return;

		const maxJatekos=document.getElementById("jatekosSzam").value;

		fetch(`https://pepa.hu/api/jatekApi/zsirozas/player`,{method:"POST",body:JSON.stringify({ name: nev, code: kod, maxJatekos:maxJatekos })})
			.then(r=>r.json())
			.then(data=>{
				console.log(data);
				if(data.error!=null)
				{
					console.log(data.error);
				}
				else
				{
                    userList(data.user.players)

				}				
			});
        upd= setInterval(function(){loginGet()},1000)
	}

    function loginGet()
	{
		nev=document.getElementById("nev").value;
		const kod=document.getElementById("kod").value;
		if(nev=="" || kod=="") return;
		fetch(`https://pepa.hu/api/jatekApi/zsirozas/lobby/${nev}/${kod}`)
			.then(r=>r.json())
			.then(data=>{
				console.log(data);
				if(data.error!=null)
				{
					document.getElementById("userek").innerHTML=data.error;
				}
				else
				{
					userList(data.user.players);
				}				
			});

        //loginGet()
	}

    
    function userList(players)
	{
		let userDiv=document.getElementById("userek");
		userDiv.innerHTML="";
		players.forEach(p => {

			let blokk=document.createElement("div");
			blokk.innerHTML =`${p.name} (${p.readyState})`;
			blokk.innerHTML+=`<button onclick="kick('${p.name}')">kick</button>`;
			blokk.innerHTML+=`<button onclick="ready('${p.name}')">ready</button>`;
			userDiv.appendChild(blokk);
		});
	}
    

    function frissit()
    {
        setInterval(loginGet(),1000)
    }
    

    </script>
</body>
</html>